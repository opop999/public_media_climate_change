# Bigram collocation frequency table
# This code reads in preprocessed text data, filters out certain parts of speech, and creates a bigram frequency table using nltk in Python.
# The resulting table is stored in a pandas dataframe called bigramFreqTable.
# IRENE WONDERS: Don't I need the reticulate and dtplyr packages for this code to work?
# TO DO:
- explain logic behind the choice of data.table
- Rewrite it to the chunks

## Load necessary packages
```{r include=FALSE}
# Package names
packages <- c("dplyr", "stringr", "data.table", "dtplyr", "jsonlite", "tidyr")

# Install packages not yet installed
installed_packages <- packages %in% rownames(installed.packages())
if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}

# Packages loading
invisible(lapply(packages, library, character.only = TRUE))
```

```{r}
# This code needs modification so it reads in and processes all of the .rds
# files that are needed for bigram analysis

# 1. step: define available chunks
# udpipe_chunks <- list.files(path = "../../2.data_transformations/data/udpipe_processed/", pattern = "*.rds", full.names = TRUE)

# 2. 
lemmata <- readRDS("../../2.data_transformations/data/udpipe_processed/udpipe_regex_2012-01.rds") %>%
    lazy_dt() %>%
    filter(upos %in% c("NOUN", "ADJ", "PROPN")) %>%
    filter(!grepl("NameType=Giv", feats, fixed = TRUE)) %>% # Explain
    transmute(doc_id, lemma = gsub("[^ěščřžýáíéóúůďťňa-z ]", " ", tolower(str_replace_na(lemma, replacement = "")))) %>% # Explain
    filter(nchar(lemma) > 1) %>% # filter one letter words 
    group_by(doc_id) %>%
    summarize(lemmatized_text = str_squish(str_c(lemma, collapse = " "))) %>%
    ungroup() %>% 
    as_tibble() %>% 
    pull(lemmatized_text) %>% 
    str_c(collapse = " ") %>% 
    str_split(" +") %>% 
    unlist()

# Question about random bigrams on the overlap of both documents.

```

# IRENE WONDERS: I get plenty of NameError messages when running this, despite installing and opening the reticulate package.

# Python installation is necessary, with nltk and pandas packages. 
# If using RStudio, go to Tools-> Options-> Python and selects the appropriate
# Python installation. For begginers, it is adviced to use Conda package
# manager with distribution like Miniconda or Anaconda (which already contains
# these packages).

```{python}
import nltk
import pandas as pd

bigrams = nltk.collocations.BigramAssocMeasures()

bigram_finder = nltk.collocations.BigramCollocationFinder.from_words(r.lemmata)
bigram_freq = bigram_finder.ngram_fd.items()
bigramFreqTable = pd.DataFrame(list(bigram_freq), columns=['bigram','freq']).sort_values(by='freq', ascending=False)

print(bigramFreqTable)
```



