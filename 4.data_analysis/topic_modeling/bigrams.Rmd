# Bigram collocation frequency table
# This code reads in preprocessed text data, filters out certain parts of speech, and creates a bigram frequency table using nltk in Python.
# The resulting table is stored in a pandas dataframe called bigramFreqTable.
# IRENE WONDERS: Don't I need the reticulate and dtplyr packages for this code to work?

```{r}
tokens <- readRDS("../../2.data_transformations/data/udpipe_processed/udpipe_regex_2012-01.rds") %>% 
    lazy_dt() %>% 
    filter(upos %in% c("NOUN", "ADJ", "PROPN")) %>%
    filter(!grepl("NameType=Giv", feats, fixed = TRUE)) %>%
    transmute(doc_id, lemma = gsub("[^ěščřžýáíéóúůďťňa-z ]", " ", tolower(str_replace_na(lemma, replacement = "")))) %>% 
    filter(nchar(lemma) > 1) %>% # filter one letter words 
    group_by(doc_id) %>%
    summarize(text = str_squish(str_c(lemma, collapse = " "))) %>%
    ungroup() %>% 
    as_tibble() %>% 
    pull(text) %>% 
    str_c(collapse = " ") %>% 
    str_split(" +") %>% 
    unlist()

```
# IRENE WONDERS: I get plenty of NameError messages when running this, despite installing and opening the reticulate package.
```{python}
import nltk
import pandas as pd

bigrams = nltk.collocations.BigramAssocMeasures()

bigram_finder = nltk.collocations.BigramCollocationFinder.from_words(r.tokens)
# bigramFinder = nltk.collocations.BigramCollocationFinder.from_words(tokens)
#bigrams
bigram_freq = bigram_finder.ngram_fd.items()
bigramFreqTable = pd.DataFrame(list(bigram_freq), columns=['bigram','freq']).sort_values(by='freq', ascending=False)
```



